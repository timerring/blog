<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I have been busy migrating my blog this week. Coincidentally, I learned that there may be cases of commit forgery on GitHub. Therefore, for security reasons, I added a GPG signature. However, when deploying Hugo, I encountered many problems regarding whether GPG signatures can also be used. Fortunately, I finally solved them."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Deploy Github Pages With GPG Signing"><meta property="og:description" content="I have been busy migrating my blog this week. Coincidentally, I learned that there may be cases of commit forgery on GitHub. Therefore, for security reasons, I added a GPG signature. However, when deploying Hugo, I encountered many problems regarding whether GPG signatures can also be used. Fortunately, I finally solved them."><meta property="og:type" content="article"><meta property="og:url" content="https://timerring.github.io/blog/posts/2024/deploy-github-pages-with-gpg-signing/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-18T23:25:21+08:00"><meta property="article:modified_time" content="2024-12-18T23:25:21+08:00"><title>Deploy Github Pages With GPG Signing | timerring</title><link rel=manifest href=/blog/manifest.json><link rel=icon href=/blog/favicon.png type=image/x-icon><link rel=stylesheet href=/blog/book.min.7239e0dcc2289fa3a2c7a7cc740d1819032d83b73d80b466eb84fd369eb71906.css integrity="sha256-cjng3MIon6Oix6fMdA0YGQMtg7c9gLRm64T9Np63GQY=" crossorigin=anonymous><script defer src=/blog/flexsearch.min.js></script>
<script defer src=/blog/en.search.min.4d870455afd949018d33edc8fee3c8a3ca8cc927987e3726ce02f45ad1d21526.js integrity="sha256-TYcEVa/ZSQGNM+3I/uPIo8qMySeYfjcmzgL0WtHSFSY=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/blog/><img src=/blog/favicon.png alt=Logo><span>timerring</span></a></h2><hr><p>To make each day count.</p><div class=book-search><div class=gcse-search></div></div><script async src="https://cse.google.com/cse.js?cx=40782701766144f96"></script><ul><li><a href=/blog/posts/>Blogs</a></li><li><a href=/blog/docs/now/>Now</a></li><li><a href=/blog/docs/about/>About</a></li><li><a href>Newsletter</a></li><li><a href=/blog/docs/friends/>Friends</a></li><li><a href=/blog/index.xml>RSS</a></li></ul><script>function goToRandomPost(){const e=["/blog/posts/2024/deploy-github-pages-with-gpg-signing/?utm_source=random","/blog/posts/2024/gpg-101/?utm_source=random","/blog/posts/2024/housewarming-2024/?utm_source=random"],t=Math.floor(Math.random()*e.length);window.location.href=e[t]}</script><a class=random onclick=goToRandomPost()>Stroll</a></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/blog/svg/menu.svg class=book-icon alt=Menu></label>
<strong>timerring</strong>
<label for=toc-control><img src=/blog/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#how-to-deploy-github-pages-with-gpg-signing-and-verify>How to Deploy Github Pages With Gpg Signing and Verify</a><ul><li><a href=#import-gpg-key>Import GPG Key</a></li><li><a href=#deploy>Deploy</a></li></ul></li><li><a href=#appendix>Appendix</a></li></ul></nav></aside></header><article class=markdown><h1>Deploy Github Pages With GPG Signing</h1><h5>December 18, 2024</h5><div><a href=/blog/categories/tutorial/>tutorial</a></div><div><a href=/blog/tags/github-pages/>github pages</a> <span style=color:#7aa874>|</span>
<a href=/blog/tags/hugo/>hugo</a> <span style=color:#7aa874>|</span>
<a href=/blog/tags/gpg/>GPG</a></div><blockquote class="book-hint info">A total of 1.02k words. Reading takes about 5 minutes</blockquote><hr><p>I have been busy migrating my blog this week. Coincidentally, I learned that there may be cases of commit forgery on GitHub. Therefore, for security reasons, I added a GPG signature. However, when deploying Hugo, I encountered many problems regarding whether GPG signatures can also be used. Fortunately, I finally solved them.</p><blockquote><p>If you don&rsquo;t know what GPG is, you can read <a href=/blog/posts/2024/gpg-101/>GPG 101</a>.</p></blockquote><h2 id=how-to-deploy-github-pages-with-gpg-signing-and-verify>How to Deploy Github Pages With Gpg Signing and Verify
<a class=anchor href=#how-to-deploy-github-pages-with-gpg-signing-and-verify>#</a></h2><p>There are two main ways to deploy:</p><ol><li>Push all source files to GitHub directly, then use the relevant action to complete the entire deployment process.</li><li>Isolate the blog source files from the built files, push the source files to the private repository of GitHub each time, and then set up the relevant workflow in the private repository to push to the public static repository.</li></ol><p>To ensure greater security, I chose the second method, deploying Hugo in the workflow of GitHub Pages, and using the <code>actions-gh-pages</code> action. However, due to various reasons, the author of this action <a href=https://github.com/peaceiris/actions-gh-pages/issues/164 target=_blank>does not want to add the GPG signature feature<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a>. Therefore, we have to solve the problem ourselves.</p><h3 id=import-gpg-key>Import GPG Key
<a class=anchor href=#import-gpg-key>#</a></h3><p>First, I found a <a href=https://github.com/crazy-max/ghaction-import-gpg target=_blank>workflow for importing GPG keys<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a> on GitHub. After reading the documentation, my own workflow is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- name: Import GPG key <span style=color:green># import the gpg key to the github action</span>
</span></span><span style=display:flex><span>  uses: crazy-max/ghaction-import-gpg@v6 <span style=color:green># repository https://github.com/crazy-max/ghaction-import-gpg</span>
</span></span><span style=display:flex><span>  with: <span style=color:green># I use the subkey to sign the commit, if you use the primary key, you can refer to his repository docs.</span>
</span></span><span style=display:flex><span>      gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }} <span style=color:green># the secret gpg subkey</span>
</span></span><span style=display:flex><span>      passphrase: ${{ secrets.PASSPHRASE }} <span style=color:green># the passphrase of the gpg subkey</span>
</span></span><span style=display:flex><span>      git_user_signingkey: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      git_commit_gpgsign: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      fingerprint: ${{ secrets.FINGERPRINT }} <span style=color:green># the fingerprint of the public subkey you use</span>
</span></span></code></pre></div><p>If you only use the primary secret key of GPG, you do not need to add the fingerprint, and I generated a dedicated subkey for signing for security reasons. Therefore, you need to specify the fingerprint of the public key of the subkey. Note that <strong>the fingerprint should be entered without spaces</strong>; otherwise, it will report an error <code>67108933 Not implemented &lt;GPG Agent></code>. I added this note to the <a href=https://github.com/crazy-max/ghaction-import-gpg/issues/146 target=_blank>corresponding issue<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a>.</p><blockquote><p>Don&rsquo;t forget to fill in the corresponding secret variables and values in the repository.</p></blockquote><h3 id=deploy>Deploy
<a class=anchor href=#deploy>#</a></h3><p>Since the author does not plan to add GPG signature, we need to clone the project and modify it ourselves. Usually, the <code>-S</code> option is used in the commit to specify the use of GPG signature. Therefore, I found the <a href=https://github.com/timerring/actions-gh-pages/commit/561aae06ebd230bf90042551dfa13cc7603313f5#diff-87ed3c6f2d658782ab84c9c4af8a4b97af5e8b0d0fb8c92ea247c7a8b2194d22L204 target=_blank>corresponding function in the commit<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a> and added the corresponding <code>-S</code> option.</p><p>Note that the modified workflow you created cannot be used directly. The author&rsquo;s instructions are as follows:</p><blockquote><p>This action and my other actions do not provide the branch execution. I add the lib/index.js for only each release commit. After releasing, I delete it.</p></blockquote><p>Therefore, we still need to publish a version ourselves. Run <code>./release.sh</code> directly in the project, and publish the version you wrote. After that, you can reference your version in the workflow, and my workflow is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- name: Deploy Web
</span></span><span style=display:flex><span>  uses: timerring/actions-gh-pages@v5.0.0 <span style=color:green># this is adjusted action from peaceiris/actions-gh-pages, you can use it directly.</span>
</span></span><span style=display:flex><span>  with:
</span></span><span style=display:flex><span>      personal_token: ${{ secrets.PERSONAL_TOKEN }} <span style=color:green># the personal token of the github action</span>
</span></span><span style=display:flex><span>      external_repository: your_username/your_repository <span style=color:green># your target repository</span>
</span></span><span style=display:flex><span>      publish_branch: main <span style=color:green># the branch you want to deploy</span>
</span></span><span style=display:flex><span>      publish_dir: ./public <span style=color:green># the directory you want to deploy</span>
</span></span><span style=display:flex><span>      user_name: ${{ secrets.USER_NAME }} <span style=color:green># the name of the github action</span>
</span></span><span style=display:flex><span>      user_email: ${{ secrets.USER_EMAIL }} # the email of the github action <span style=color:green># ATTENTION: please add your github verified email</span>
</span></span><span style=display:flex><span>      commit_message: ${{ github.event.head_commit.message }}
</span></span></code></pre></div><p>Note that <strong>please ensure that you add the email verified by GitHub</strong>; otherwise, the default parameter <code>${process.env.GITHUB_ACTOR}@users.noreply.github.com</code> will only generate <code>USERNAME@users.noreply.github.com</code>, not <code>ID+USERNAME@users.noreply.github.com</code>. This is a historical issue with GitHub, <a href=https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address target=_blank>details can be found here<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a>. However, your private key does not contain this UUID, so it cannot be verified by GPG. (Even if you add this UID to the keys, since the user email has not been verified by GitHub, it will only display <code>unverified</code> in the end.)</p><blockquote><p>In short, if your GitHub account was created after July 18, 2017, then your GitHub email address is <code>ID+USERNAME@users.noreply.github.com</code>, not the default <code>USERNAME@users.noreply.github.com</code>. In this case, you need to specify the <code>user_email</code> parameter and fill in the email address you have verified.</p></blockquote><p>Finally, after pushing to the <code>blogsource</code> repository, the workflow will automatically deploy to the <code>blog</code> repository, and the commit will be signed with GPG and display <code>verified</code>!</p><p>You can check my result <a href=https://github.com/timerring/blog/commits/main/ target=_blank>here<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a>, every commit pushed from the <code>blogsource</code> repository will be signed with GPG and display <code>verified</code>.</p><h2 id=appendix>Appendix
<a class=anchor href=#appendix>#</a></h2><p>If you also need my hugo deployment method, you can directly use the action version I modified and released, <a href=https://github.com/timerring/actions-gh-pages target=_blank>repository address timerring/actions-gh-pages<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a>, refer to my complete workflow yaml, and don&rsquo;t forget to fill in the corresponding secret variables and values:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>name: deploy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on:
</span></span><span style=display:flex><span>    push:
</span></span><span style=display:flex><span>        branches:
</span></span><span style=display:flex><span>            - main
</span></span><span style=display:flex><span>    workflow_dispatch:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jobs:
</span></span><span style=display:flex><span>    build:
</span></span><span style=display:flex><span>        runs-on: ubuntu-latest
</span></span><span style=display:flex><span>        steps:
</span></span><span style=display:flex><span>            - name: Checkout
</span></span><span style=display:flex><span>              uses: actions/checkout@v3
</span></span><span style=display:flex><span>              with:
</span></span><span style=display:flex><span>                  submodules: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>                  fetch-depth: 0
</span></span><span style=display:flex><span>                  ref: main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            - name: Setup Hugo
</span></span><span style=display:flex><span>              uses: peaceiris/actions-hugo@v2
</span></span><span style=display:flex><span>              with:
</span></span><span style=display:flex><span>                  hugo-version: <span style=color:#a31515>&#34;0.108.0&#34;</span>
</span></span><span style=display:flex><span>                  extended: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            - name: Build Web
</span></span><span style=display:flex><span>              run: hugo --minify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            - name: Import GPG key <span style=color:green># import the gpg key to the github action</span>
</span></span><span style=display:flex><span>              uses: crazy-max/ghaction-import-gpg@v6 <span style=color:green># repository https://github.com/crazy-max/ghaction-import-gpg</span>
</span></span><span style=display:flex><span>              with: <span style=color:green># I use the subkey to sign the commit, if you use the primary key, you can refer to his repository docs.</span>
</span></span><span style=display:flex><span>                  gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }} <span style=color:green># the secret gpg subkey</span>
</span></span><span style=display:flex><span>                  passphrase: ${{ secrets.PASSPHRASE }} <span style=color:green># the passphrase of the gpg subkey</span>
</span></span><span style=display:flex><span>                  git_user_signingkey: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>                  git_commit_gpgsign: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>                  fingerprint: ${{ secrets.FINGERPRINT }} <span style=color:green># the fingerprint of the public subkey you use</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            - name: Deploy Web
</span></span><span style=display:flex><span>              uses: timerring/actions-gh-pages@v5.0.0 <span style=color:green># this is adjusted action from peaceiris/actions-gh-pages, you can use it directly.</span>
</span></span><span style=display:flex><span>              with:
</span></span><span style=display:flex><span>                  personal_token: ${{ secrets.PERSONAL_TOKEN }} <span style=color:green># the personal token of the github action</span>
</span></span><span style=display:flex><span>                  external_repository: your_username/your_repository <span style=color:green># your target repository</span>
</span></span><span style=display:flex><span>                  publish_branch: main <span style=color:green># the branch you want to deploy</span>
</span></span><span style=display:flex><span>                  publish_dir: ./public <span style=color:green># the directory you want to deploy</span>
</span></span><span style=display:flex><span>                  user_name: ${{ secrets.USER_NAME }} <span style=color:green># the name of the github action</span>
</span></span><span style=display:flex><span>                  user_email: ${{ secrets.USER_EMAIL }} # the email of the github action <span style=color:green># ATTENTION: please add your github verified email</span>
</span></span><span style=display:flex><span>                  commit_message: ${{ github.event.head_commit.message }}
</span></span></code></pre></div><h2>Related readings</h2><ul><li><a href="/blog/posts/2024/gpg-101/?utm_source=related">GPG 101</a></li><li><a href="/blog/posts/2024/housewarming-2024/?utm_source=related">Housewarming 2024</a></li></ul><hr><div class=post-nav><a href="https://timerring.github.io/blog/posts/2024/gpg-101/?utm_source=nav">&lt;&lt; prev | GPG 101</a>
<a onclick=goToRandomPost() style=cursor:pointer>Continue strolling</a></div><hr><blockquote class="book-hint info">If you find this blog useful and want to support my blog, need my skill for something, or have a coffee chat with me, feel free to:</blockquote><hr><div class=support><a href="https://www.patreon.com/bePatron?u=46962965" class=book-btn target=_blank>Subscribe Patreon to participate in blog topics and custom services</a>
<a href=https://ko-fi.com/S6S130C16 class=book-btn target=_blank>Buy me a coffee</a></div><div style=margin-bottom:8px></div><script>function goToRandomPost(){const e=["/blog/posts/2024/deploy-github-pages-with-gpg-signing/?utm_source=random","/blog/posts/2024/gpg-101/?utm_source=random","/blog/posts/2024/housewarming-2024/?utm_source=random"],t=Math.floor(Math.random()*e.length);window.location.href=e[t]}</script></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><div class="book-tabs-content markdown-inner"><div id=tcomment></div><script src=https://giscus.app/client.js data-repo=timerring/blog data-repo-id=R_kgDONeZYZg data-category=Announcements data-category-id=DIC_kwDONeZYZs4ClRWs data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#how-to-deploy-github-pages-with-gpg-signing-and-verify>How to Deploy Github Pages With Gpg Signing and Verify</a><ul><li><a href=#import-gpg-key>Import GPG Key</a></li><li><a href=#deploy>Deploy</a></li></ul></li><li><a href=#appendix>Appendix</a></li></ul></nav></div></aside></main></body></html>