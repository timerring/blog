<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Normally, we often write a Dockerfile in the current directory.

The Dockerfile is a configuration file that describes how to build the image. You can refer to the official documentation for more details.
If you list more than one CMD, only the last one takes effect. So if you have multiple commands to run, you better write them in a script file.
Docker is not the VMware, there is no systemd in the container. Its startup program is the container application process. The container exists for the main process. Once the main process exits, the container loses its meaning of existence and thus exits. So when you execute multiple commands and if they are blocking, you better write the previous commands in nohup and the last command in the blocking command. (never use the command such as CMD service nginx start, the CMD only will execute as CMD [ &#34;sh&#34;, &#34;-c&#34;, &#34;service nginx start&#34;], when the sh is executed, the container will exit, the correct way is run it directly CMD [&#34;nginx&#34;, &#34;-g&#34;, &#34;daemon off;&#34;])
"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="The Tips About Dockerfile"><meta property="og:description" content="Normally, we often write a Dockerfile in the current directory.

The Dockerfile is a configuration file that describes how to build the image. You can refer to the official documentation for more details.
If you list more than one CMD, only the last one takes effect. So if you have multiple commands to run, you better write them in a script file.
Docker is not the VMware, there is no systemd in the container. Its startup program is the container application process. The container exists for the main process. Once the main process exits, the container loses its meaning of existence and thus exits. So when you execute multiple commands and if they are blocking, you better write the previous commands in nohup and the last command in the blocking command. (never use the command such as CMD service nginx start, the CMD only will execute as CMD [ &#34;sh&#34;, &#34;-c&#34;, &#34;service nginx start&#34;], when the sh is executed, the container will exit, the correct way is run it directly CMD [&#34;nginx&#34;, &#34;-g&#34;, &#34;daemon off;&#34;])
"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.timerring.com/posts/the-tips-about-dockerfile/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-18T21:05:23+08:00"><meta property="article:modified_time" content="2025-01-18T21:05:23+08:00"><title>The Tips About Dockerfile | timerring</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.e5c400e9a39f7eafc90351230108cdc038497f3b6478689fe605ab3dd006274d.css integrity="sha256-5cQA6aOffq/JA1EjAQjNwDhJfztkeGif5gWrPdAGJ00=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.ccceca45bf4c6bf48ad72c14d1e1147fa2eb41fcd339bb95eaec6853d0ae1a38.js integrity="sha256-zM7KRb9Ma/SK1ywU0eEUf6LrQfzTObuV6uxoU9CuGjg=" crossorigin=anonymous></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/favicon.png alt=Logo><span>timerring</span></a></h2><hr><p>Rhythmic trend.</p><div class=book-search><div class=gcse-search></div></div><script async src="https://cse.google.com/cse.js?cx=40782701766144f96"></script><ul><li><a href=/>Dashboard</a></li><li><a href=/posts/>Blogs</a></li><li><a href=/categories/weekly/>Newsletter</a></li><li><a href=/index.xml>RSS</a></li><li><a href=/friends/>Friends</a></li><li><a href=/about/>About</a></li></ul><script>function goToRandomPost(){const e=["/posts/further-understanding-of-proc/?utm_source=random","/posts/the-iftop/?utm_source=random","/posts/reflections-on-trending-topics/?utm_source=random","/posts/cpu-can-only-see-the-threads/?utm_source=random","/posts/go-common-test/?utm_source=random","/posts/go-concurrency-and-parallelism/?utm_source=random","/posts/go-cheatsheet/?utm_source=random","/posts/video-technology-101/?utm_source=random","/posts/the-main-kind-of-message-queue/?utm_source=random","/posts/the-method-to-manage-traffic/?utm_source=random","/posts/the-different-kind-of-api-design/?utm_source=random","/posts/the-encode-and-decode-in-python/?utm_source=random","/posts/about-the-systemd/?utm_source=random","/posts/the-tips-about-dockerfile/?utm_source=random","/posts/docker-cheatsheet/?utm_source=random","/posts/docker-101/?utm_source=random","/posts/the-instance-class-static-magic-method-in-python/?utm_source=random","/posts/the-overview-of-security/?utm_source=random","/posts/how-to-publish-your-code-as-a-pip-module/?utm_source=random","/posts/some-good-things-to-share-about-the-packages/?utm_source=random","/posts/introduction-to-the-http-and-https-protocol/?utm_source=random","/posts/mail-service-and-protocol/?utm_source=random","/posts/thinking-about-advertisement-from-an-open-source-perspective/?utm_source=random","/posts/understanding-clash-through-configuration/?utm_source=random","/posts/a-brief-introduction-to-dns/?utm_source=random","/posts/real-computer-network/?utm_source=random","/posts/python-generator-iterator-and-decorator/?utm_source=random","/posts/python-underlying-mechanism/?utm_source=random","/posts/python-files-exceptions-and-modules/?utm_source=random","/posts/python-object-oriented-programming/?utm_source=random","/posts/python-cheatsheet/?utm_source=random","/posts/python-function-parameter/?utm_source=random","/posts/python-control-structure/?utm_source=random","/posts/python-composite-data-type/?utm_source=random","/posts/python-basic-data-type/?utm_source=random","/posts/python-basic-syntax-elements/?utm_source=random","/posts/deploy-github-pages-with-gpg-signing/?utm_source=random","/posts/gpg-101/?utm_source=random","/posts/housewarming-2024/?utm_source=random"],t=Math.floor(Math.random()*e.length);window.location.href=e[t]}</script><a class=random onclick=goToRandomPost()>Stroll</a></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>timerring</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#exec-pattern>exec pattern</a></li><li><a href=#shell-pattern>shell pattern</a></li><li><a href=#cmd>CMD</a></li><li><a href=#entrypoint>ENTRYPOINT</a></li><li><a href=#conclusion>conclusion</a></li></ul></nav><style>.book-toc .book-toc-content a{color:var(--body-font-color)}</style></aside></header><article class=markdown><h1>The Tips About Dockerfile</h1><h5>January 18, 2025
·
3 min read
<span id=busuanzi_container_page_pv>· Page View: <span id=busuanzi_value_page_pv></span></span></h5><div><a href=/categories/tutorial/ style=color:#000>Tutorial</a></div><div><a href=/tags/docker/ style=color:#000>Docker</a></div><blockquote class="book-hint info">If you have any questions, feel free to comment below.</blockquote><hr><p>Normally, we often write a <code>Dockerfile</code> in the current directory.</p><ul><li>The <code>Dockerfile</code> is a configuration file that describes how to build the image. You can refer to the <a href=https://docs.docker.com/reference/dockerfile/ target=_blank>official documentation<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></a> for more details.</li><li>If you list <strong>more than one</strong> <code>CMD</code>, only the last one takes effect. So if you have multiple commands to run, you better write them in a script file.</li><li>Docker is not the VMware, there is no <code>systemd</code> in the container. Its startup program is the container application process. The container exists for the main process. Once the main process exits, the container loses its meaning of existence and thus exits. So when you execute multiple commands and if they are blocking, you better write the previous commands in nohup and the last command in the blocking command. (never use the command such as <code>CMD service nginx start</code>, the CMD only will execute as <code>CMD [ "sh", "-c", "service nginx start"]</code>, when the sh is executed, the container will exit, the correct way is run it directly <code>CMD ["nginx", "-g", "daemon off;"]</code>)</li></ul><p>Then, run the following command to build the image:</p><p><code>docker build -t my_image:1.0 .</code>: the <code>-t</code> means tag, the <code>.</code> means the current directory(actually, it is the context of the dockerfile, but considering many people only use the same method, so here call it current). Besides, you can also build from .tar.gz file.</p><p>You can just refer to the official docs, but there is only one command that you should pay attention to: <code>ENTRYPOINT</code>.</p><p>If you want to tell the difference between <code>CMD</code> and <code>ENTRYPOINT</code>, you should first understand the <code>shell</code> pattern and the <code>exec</code> pattern.</p><h2 id=exec-pattern>exec pattern
<a class=anchor href=#exec-pattern>#</a></h2><p>The feature of <code>exec</code> pattern is that it <strong>will not pass the command</strong> through the shell. So the environment variables such as <code>$HOME</code> will not be passed.</p><pre tabindex=0><code>CMD [ &#34;echo&#34;, &#34;$HOME&#34; ]
... run docker run ...
... output: $HOME
</code></pre><p>But use the exec to <strong>run the shell</strong> you can get the correct result.</p><pre tabindex=0><code>CMD [ &#34;sh&#34;, &#34;-c&#34;, &#34;echo&#34;, &#34;$HOME&#34; ]
... run docker run ...
... output: /root
</code></pre><h2 id=shell-pattern>shell pattern
<a class=anchor href=#shell-pattern>#</a></h2><p>The shell pattern will execute the command via <code>/bin/sh -c "task command"</code>, which means <strong>the no.1 process is not the task process but the <code>bash</code> process</strong>.</p><pre tabindex=0><code>CMD top
... run docker run ...
PID1 /bin/sh -c top
PID7 top
</code></pre><h2 id=cmd>CMD
<a class=anchor href=#cmd>#</a></h2><p>There are three ways to use <code>CMD</code>.</p><ul><li><code>CMD ["executable","param1","param2"]</code> (exec pattern)<ul><li><code>CMD ["param1","param2"]</code> (provide the entrypoint parameters)</li></ul></li><li><code>CMD command param1 param2</code> (shell pattern) == <code>CMD ["sh", "-c", "command param1 param2"]</code></li></ul><p>The both pattern of CMD command will be <strong>overwritten</strong> by the command in the end of the <code>docker run</code> command.
The overwrite command will also run in the same pattern.</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#408080;font-style:italic># Example 1</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:green;font-weight:700>CMD</span> <span style=color:green>echo</span> <span style=color:#ba2121>&#34;hello&#34;</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:#408080;font-style:italic># docker run my_image:1.0 top</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:#408080;font-style:italic># top</span><span>
</span></span></span><span style=display:flex><span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:#408080;font-style:italic># Example 2</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:green;font-weight:700>ENTRYPOINT</span> [<span style=color:#ba2121>&#34;/bin/echo&#34;</span>, <span style=color:#ba2121>&#34;Hello,&#34;</span>]<span>
</span></span></span><span style=display:flex><span><span></span><span style=color:green;font-weight:700>CMD</span> [<span style=color:#ba2121>&#34;world!&#34;</span>]<span>
</span></span></span><span style=display:flex><span><span></span><span style=color:#408080;font-style:italic># docker run myimage &#34;GPT3&#34;</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:#408080;font-style:italic># Hello, GPT3</span><span>
</span></span></span></code></pre></div><h2 id=entrypoint>ENTRYPOINT
<a class=anchor href=#entrypoint>#</a></h2><p>There are two ways to use <code>ENTRYPOINT</code>.</p><ul><li><code>ENTRYPOINT ["executable","param1","param2"]</code> (exec pattern)</li><li><code>ENTRYPOINT command param1 param2</code> (shell pattern)</li></ul><p>In exec pattern, the ENTRYPOINT command will not be overwritten by the command in the end of the <code>docker run</code> command. Such as <code>docker run my_image:1.0 -c</code>. The <code>-c</code> will not overwrite the <code>ENTRYPOINT [ "top", "-b" ]</code>, but it will be <strong>added</strong> to the <code>ENTRYPOINT</code> command as <code>ENTRYPOINT [ "top", "-b", "-c" ]</code>.</p><p>In shell pattern, your custom command will be ignored by the <code>ENTRYPOINT</code> command. Such as <code>docker run my_image:1.0 -c</code>. The <code>-c</code> will be <strong>ignored</strong> by the <code>ENTRYPOINT top</code>, and the command will still be <code>top</code>.</p><blockquote><p>You can also <strong>overwrite</strong> the <code>ENTRYPOINT</code> command by using the <code>--entrypoint xxx</code> follow the <code>docker run</code> command.</p></blockquote><p>You can choose <code>CMD</code> or <code>ENTRYPOINT</code> according to your specific needs.</p><ul><li>If you want to create an image with default behavior, and allow users to override the default behavior, you can use <code>CMD</code>.</li><li>If you want to create an image that always executes a specific command, and allows users to pass parameters, you can use <code>ENTRYPOINT</code>.</li><li>At the same time, <code>CMD</code> and <code>ENTRYPOINT</code> can also be used together, in which case the parameters specified in <code>CMD</code> will be used as the default parameters for the command specified by <code>ENTRYPOINT</code>.</li></ul><h2 id=conclusion>conclusion
<a class=anchor href=#conclusion>#</a></h2><ul><li>shellmode: The main process(pid 1) is the <code>/bin/sh</code> process, which can resolve the environment variables.</li><li>execmode: The main process is the command you specify, and the environment variables will not be resolved.</li><li>If ENTRYPOINT uses shellmode, the default CMD instruction will be ignored.</li><li>If ENTRYPOINT uses execmode, the content specified in default CMD instruction will be <strong>appended</strong> as parameters for the command specified by ENTRYPOINT. <strong>If ENTRYPOINT uses execmode, the default CMD instruction should also use exec mode</strong>.</li></ul><p><img src=https://cdn.jsdelivr.net/gh/timerring/scratchpad2023/2024/2025-01-18-21-26-10.png alt></p><h2>Related readings</h2><ul><li><a href="/posts/docker-cheatsheet/?utm_source=related">Docker Cheatsheet</a></li><li><a href="/posts/docker-101/?utm_source=related">Docker 101</a></li></ul><hr><div class=post-nav><a href="https://blog.timerring.com/posts/docker-cheatsheet/?utm_source=nav">&lt;&lt; prev | Docker...</a>
<a onclick=goToRandomPost() style=cursor:pointer>Continue strolling</a>
<a href="https://blog.timerring.com/posts/about-the-systemd/?utm_source=nav">About the... ｜ next >></a></div><hr>If you find this blog useful and want to support my blog, need my skill for something, or have a coffee chat with me, feel free to:<div class=support><a href=https://ko-fi.com/polls/What-is-the-custom-topic-for-the-next-month-C0C219LHQJ class=book-btn target=_blank>Subscribe to participate in blog topics and custom services</a>
<a href=https://ko-fi.com/timerring class=book-btn target=_blank>Buy me a coffee</a></div><div style=margin-bottom:8px></div><script>function goToRandomPost(){const e=["/posts/further-understanding-of-proc/?utm_source=random","/posts/the-iftop/?utm_source=random","/posts/reflections-on-trending-topics/?utm_source=random","/posts/cpu-can-only-see-the-threads/?utm_source=random","/posts/go-common-test/?utm_source=random","/posts/go-concurrency-and-parallelism/?utm_source=random","/posts/go-cheatsheet/?utm_source=random","/posts/video-technology-101/?utm_source=random","/posts/the-main-kind-of-message-queue/?utm_source=random","/posts/the-method-to-manage-traffic/?utm_source=random","/posts/the-different-kind-of-api-design/?utm_source=random","/posts/the-encode-and-decode-in-python/?utm_source=random","/posts/about-the-systemd/?utm_source=random","/posts/the-tips-about-dockerfile/?utm_source=random","/posts/docker-cheatsheet/?utm_source=random","/posts/docker-101/?utm_source=random","/posts/the-instance-class-static-magic-method-in-python/?utm_source=random","/posts/the-overview-of-security/?utm_source=random","/posts/how-to-publish-your-code-as-a-pip-module/?utm_source=random","/posts/some-good-things-to-share-about-the-packages/?utm_source=random","/posts/introduction-to-the-http-and-https-protocol/?utm_source=random","/posts/mail-service-and-protocol/?utm_source=random","/posts/thinking-about-advertisement-from-an-open-source-perspective/?utm_source=random","/posts/understanding-clash-through-configuration/?utm_source=random","/posts/a-brief-introduction-to-dns/?utm_source=random","/posts/real-computer-network/?utm_source=random","/posts/python-generator-iterator-and-decorator/?utm_source=random","/posts/python-underlying-mechanism/?utm_source=random","/posts/python-files-exceptions-and-modules/?utm_source=random","/posts/python-object-oriented-programming/?utm_source=random","/posts/python-cheatsheet/?utm_source=random","/posts/python-function-parameter/?utm_source=random","/posts/python-control-structure/?utm_source=random","/posts/python-composite-data-type/?utm_source=random","/posts/python-basic-data-type/?utm_source=random","/posts/python-basic-syntax-elements/?utm_source=random","/posts/deploy-github-pages-with-gpg-signing/?utm_source=random","/posts/gpg-101/?utm_source=random","/posts/housewarming-2024/?utm_source=random"],t=Math.floor(Math.random()*e.length);window.location.href=e[t]}</script></article><div class=book-comments><div class="book-tabs-content markdown-inner"><div id=tcomment></div><script src=https://giscus.app/client.js data-repo=timerring/blog data-repo-id=R_kgDONeZYZg data-category=Announcements data-category-id=DIC_kwDONeZYZs4ClRWs data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></div><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><div class=busuanzi-footer><p style=text-align:center>&copy; 2022 - present <a href=https://github.com/timerring>timerring</a> | PV: <span id=busuanzi_value_site_pv></span> | UV: <span id=busuanzi_value_site_uv></span></p></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#exec-pattern>exec pattern</a></li><li><a href=#shell-pattern>shell pattern</a></li><li><a href=#cmd>CMD</a></li><li><a href=#entrypoint>ENTRYPOINT</a></li><li><a href=#conclusion>conclusion</a></li></ul></nav><style>.book-toc .book-toc-content a{color:var(--body-font-color)}</style></div></aside></main></body></html>